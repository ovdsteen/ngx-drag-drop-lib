export const DROP_EFFECTS = ['move', 'copy', 'link'];
export const CUSTOM_MIME_TYPE = 'application/x-dnd';
export const JSON_MIME_TYPE = 'application/json';
export const MSIE_MIME_TYPE = 'Text';
function mimeTypeIsCustom(mimeType) {
    return mimeType.substr(0, CUSTOM_MIME_TYPE.length) === CUSTOM_MIME_TYPE;
}
export function getWellKnownMimeType(event) {
    if (event.dataTransfer) {
        const types = event.dataTransfer.types;
        // IE 9 workaround.
        if (!types) {
            return MSIE_MIME_TYPE;
        }
        for (let i = 0; i < types.length; i++) {
            if (types[i] === MSIE_MIME_TYPE ||
                types[i] === JSON_MIME_TYPE ||
                mimeTypeIsCustom(types[i])) {
                return types[i];
            }
        }
    }
    return null;
}
export function setDragData(event, data, effectAllowed) {
    // Internet Explorer and Microsoft Edge don't support custom mime types, see design doc:
    // https://github.com/marceljuenemann/angular-drag-and-drop-lists/wiki/Data-Transfer-Design
    const mimeType = CUSTOM_MIME_TYPE + (data.type ? '-' + data.type : '');
    const dataString = JSON.stringify(data);
    try {
        event.dataTransfer?.setData(mimeType, dataString);
    }
    catch (e) {
        //   Setting a custom MIME type did not work, we are probably in IE or Edge.
        try {
            event.dataTransfer?.setData(JSON_MIME_TYPE, dataString);
        }
        catch (e) {
            //   We are in Internet Explorer and can only use the Text MIME type. Also note that IE
            //   does not allow changing the cursor in the dragover event, therefore we have to choose
            //   the one we want to display now by setting effectAllowed.
            const effectsAllowed = filterEffects(DROP_EFFECTS, effectAllowed);
            if (event.dataTransfer) {
                event.dataTransfer.effectAllowed = effectsAllowed[0];
            }
            event.dataTransfer?.setData(MSIE_MIME_TYPE, dataString);
        }
    }
}
export function getDropData(event, dragIsExternal) {
    // check if the mime type is well known
    const mimeType = getWellKnownMimeType(event);
    // drag did not originate from [dndDraggable]
    if (dragIsExternal === true) {
        if (mimeType !== null && mimeTypeIsCustom(mimeType)) {
            // the type of content is well known and safe to handle
            return JSON.parse(event.dataTransfer?.getData(mimeType) ?? '{}');
        }
        // the contained data is unknown, let user handle it
        return {};
    }
    if (mimeType !== null) {
        // the type of content is well known and safe to handle
        return JSON.parse(event.dataTransfer?.getData(mimeType) ?? '{}');
    }
    // the contained data is unknown, let user handle it
    return {};
}
export function filterEffects(effects, allowed) {
    if (allowed === 'all' || allowed === 'uninitialized') {
        return effects;
    }
    return effects.filter(function (effect) {
        return allowed.toLowerCase().indexOf(effect) !== -1;
    });
}
export function getDirectChildElement(parentElement, childElement) {
    let directChild = childElement;
    while (directChild.parentNode !== parentElement) {
        // reached root node without finding given parent
        if (!directChild.parentNode) {
            return null;
        }
        directChild = directChild.parentNode;
    }
    return directChild;
}
export function shouldPositionPlaceholderBeforeElement(event, element, horizontal) {
    const bounds = element.getBoundingClientRect();
    // If the pointer is in the upper half of the list item element,
    // we position the placeholder before the list item, otherwise after it.
    if (horizontal) {
        return event.clientX < bounds.left + bounds.width / 2;
    }
    return event.clientY < bounds.top + bounds.height / 2;
}
export function calculateDragImageOffset(event, dragImage) {
    const dragImageComputedStyle = window.getComputedStyle(dragImage);
    const paddingTop = parseFloat(dragImageComputedStyle.paddingTop) || 0;
    const paddingLeft = parseFloat(dragImageComputedStyle.paddingLeft) || 0;
    const borderTop = parseFloat(dragImageComputedStyle.borderTopWidth) || 0;
    const borderLeft = parseFloat(dragImageComputedStyle.borderLeftWidth) || 0;
    return {
        x: event.offsetX + paddingLeft + borderLeft,
        y: event.offsetY + paddingTop + borderTop,
    };
}
export function setDragImage(event, dragImage, offsetFunction) {
    const offset = offsetFunction(event, dragImage) || { x: 0, y: 0 };
    event.dataTransfer.setDragImage(dragImage, offset.x, offset.y);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG5kLXV0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvZG5kL3NyYy9saWIvZG5kLXV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWlCQSxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUcsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBaUIsQ0FBQztBQUVyRSxNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FBRyxtQkFBbUIsQ0FBQztBQUNwRCxNQUFNLENBQUMsTUFBTSxjQUFjLEdBQUcsa0JBQWtCLENBQUM7QUFDakQsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFHLE1BQU0sQ0FBQztBQUVyQyxTQUFTLGdCQUFnQixDQUFDLFFBQWdCO0lBQ3hDLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLEtBQUssZ0JBQWdCLENBQUM7QUFDMUUsQ0FBQztBQUVELE1BQU0sVUFBVSxvQkFBb0IsQ0FBQyxLQUFnQjtJQUNuRCxJQUFJLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUN2QixNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQztRQUV2QyxtQkFBbUI7UUFDbkIsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ1gsT0FBTyxjQUFjLENBQUM7UUFDeEIsQ0FBQztRQUVELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDdEMsSUFDRSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssY0FBYztnQkFDM0IsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLGNBQWM7Z0JBQzNCLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUMxQixDQUFDO2dCQUNELE9BQU8sS0FBSyxDQUFDLENBQUMsQ0FBQyxD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QyxDQUFDO0lBRTNFLE9BQU87UUFDTCxDQUFDLEVBQUUsS0FBSyxDQUFDLE9BQU8sR0FBRyxXQUFXLEdBQUcsVUFBVTtRQUMzQyxDQUFDLEVBQUUsS0FBSyxDQUFDLE9BQU8sR0FBRyxVQUFVLEdBQUcsU0FBUztLQUMxQyxDQUFDO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSxZQUFZLENBQzFCLEtBQWdCLEVBQ2hCLFNBQWtCLEVBQ2xCLGNBQTBDO0lBRTFDLE1BQU0sTUFBTSxHQUFHLGNBQWMsQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztJQUVqRSxLQUFLLENBQUMsWUFBb0IsQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEcm9wRWZmZWN0LCBFZmZlY3RBbGxvd2VkIH0gZnJvbSAnLi9kbmQtdHlwZXMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIERyYWdEcm9wRGF0YSB7XG4gIGRhdGE/OiBhbnk7XG4gIHR5cGU/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRG5kRXZlbnQgZXh0ZW5kcyBEcmFnRXZlbnQge1xuICBfZG5kVXNpbmdIYW5kbGU/OiBib29sZWFuO1xuICBfZG5kRHJvcHpvbmVBY3RpdmU/OiB0cnVlO1xufVxuXG5leHBvcnQgdHlwZSBEbmREcmFnSW1hZ2VPZmZzZXRGdW5jdGlvbiA9IChcbiAgZXZlbnQ6IERyYWdFdmVudCxcbiAgZHJhZ0ltYWdlOiBFbGVtZW50XG4pID0+IHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfTtcblxuZXhwb3J0IGNvbnN0IERST1BfRUZGRUNUUyA9IFsnbW92ZScsICdjb3B5JywgJ2xpbmsnXSBhcyBEcm9wRWZmZWN0W107XG5cbmV4cG9ydCBjb25zdCBDVVNUT01fTUlNRV9UWVBFID0gJ2FwcGxpY2F0aW9uL3gtZG5kJztcbmV4cG9ydCBjb25zdCBKU09OX01JTUVfVFlQRSA9ICdhcHBsaWNhdGlvbi9qc29uJztcbmV4cG9ydCBjb25zdCBNU0lFX01JTUVfVFlQRSA9ICdUZXh0JztcblxuZnVuY3Rpb24gbWltZVR5cGVJc0N1c3RvbShtaW1lVHlwZTogc3RyaW5nKSB7XG4gIHJldHVybiBtaW1lVHlwZS5zdWJzdHIoMCwgQ1VTVE9NX01JTUVfVFlQRS5sZW5ndGgpID09PSBDVVNUT01fTUlNRV9UWVBFO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0V2VsbEtub3duTWltZVR5cGUoZXZlbnQ6IERyYWdFdmVudCk6IHN0cmluZyB8IG51bGwge1xuICBpZiAoZXZlbnQuZGF0YVRyYW5zZmVyKSB7XG4gICAgY29uc3QgdHlwZXMgPSBldmVudC5kYXRhVHJhbnNmZXIudHlwZXM7XG5cbiAgICAvLyBJRSA5IHdvcmthcm91bmQuXG4gICAgaWYgKCF0eXBlcykge1xuICAgICAgcmV0dXJuIE1TSUVfTUlNRV9UWVBFO1xuICAgIH1cblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHlwZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChcbiAgICAgICAgdHlwZXNbaV0gPT09IE1TSUVfTUlNRV9UWVBFIHx8XG4gICAgICAgIHR5cGVzW2ldID09PSBKU09OX01JTUVfVFlQRSB8fFxuICAgICAgICBtaW1lVHlwZUlzQ3VzdG9tKHR5cGVzW2ldKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiB0eXBlc1tpXTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldERyYWdEYXRhKFxuICBldmVudDogRHJhZ0V2ZW50LFxuICBkYXRhOiBEcmFnRHJvcERhdGEsXG4gIGVmZmVjdEFsbG93ZWQ6IEVmZmVjdEFsbG93ZWRcbik6IHZvaWQge1xuICAvLyBJbnRlcm5ldCBFeHBsb3JlciBhbmQgTWljcm9zb2Z0IEVkZ2UgZG9uJ3Qgc3VwcG9ydCBjdXN0b20gbWltZSB0eXBlcywgc2VlIGRlc2lnbiBkb2M6XG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9tYXJjZWxqdWVuZW1hbm4vYW5ndWxhci1kcmFnLWFuZC1kcm9wLWxpc3RzL3dpa2kvRGF0YS1UcmFuc2Zlci1EZXNpZ25cbiAgY29uc3QgbWltZVR5cGUgPSBDVVNUT01fTUlNRV9UWVBFICsgKGRhdGEudHlwZSA/ICctJyArIGRhdGEudHlwZSA6ICcnKTtcblxuICBjb25zdCBkYXRhU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoZGF0YSk7XG5cbiAgdHJ5IHtcbiAgICBldmVudC5kYXRhVHJhbnNmZXI/LnNldERhdGEobWltZVR5cGUsIGRhdGFTdHJpbmcpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gICBTZXR0aW5nIGEgY3VzdG9tIE1JTUUgdHlwZSBkaWQgbm90IHdvcmssIHdlIGFyZSBwcm9iYWJseSBpbiBJRSBvciBFZGdlLlxuICAgIHRyeSB7XG4gICAgICBldmVudC5kYXRhVHJhbnNmZXI/LnNldERhdGEoSlNPTl9NSU1FX1RZUEUsIGRhdGFTdHJpbmcpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vICAgV2UgYXJlIGluIEludGVybmV0IEV4cGxvcmVyIGFuZCBjYW4gb25seSB1c2UgdGhlIFRleHQgTUlNRSB0eXBlLiBBbHNvIG5vdGUgdGhhdCBJRVxuICAgICAgLy8gICBkb2VzIG5vdCBhbGxvdyBjaGFuZ2luZyB0aGUgY3Vyc29yIGluIHRoZSBkcmFnb3ZlciBldmVudCwgdGhlcmVmb3JlIHdlIGhhdmUgdG8gY2hvb3NlXG4gICAgICAvLyAgIHRoZSBvbmUgd2Ugd2FudCB0byBkaXNwbGF5IG5vdyBieSBzZXR0aW5nIGVmZmVjdEFsbG93ZWQuXG4gICAgICBjb25zdCBlZmZlY3RzQWxsb3dlZCA9IGZpbHRlckVmZmVjdHMoRFJPUF9FRkZFQ1RTLCBlZmZlY3RBbGxvd2VkKTtcbiAgICAgIGlmIChldmVudC5kYXRhVHJhbnNmZXIpIHtcbiAgICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyLmVmZmVjdEFsbG93ZWQgPSBlZmZlY3RzQWxsb3dlZFswXTtcbiAgICAgIH1cblxuICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyPy5zZXREYXRhKE1TSUVfTUlNRV9UWVBFLCBkYXRhU3RyaW5nKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldERyb3BEYXRhKFxuICBldmVudDogRHJhZ0V2ZW50LFxuICBkcmFnSXNFeHRlcm5hbDogYm9vbGVhblxuKTogRHJhZ0Ryb3BEYXRhIHtcbiAgLy8gY2hlY2sgaWYgdGhlIG1pbWUgdHlwZSBpcyB3ZWxsIGtub3duXG4gIGNvbnN0IG1pbWVUeXBlID0gZ2V0V2VsbEtub3duTWltZVR5cGUoZXZlbnQpO1xuXG4gIC8vIGRyYWcgZGlkIG5vdCBvcmlnaW5hdGUgZnJvbSBbZG5kRHJhZ2dhYmxlXVxuICBpZiAoZHJhZ0lzRXh0ZXJuYWwgPT09IHRydWUpIHtcbiAgICBpZiAobWltZVR5cGUgIT09IG51bGwgJiYgbWltZVR5cGVJc0N1c3RvbShtaW1lVHlwZSkpIHtcbiAgICAgIC8vIHRoZSB0eXBlIG9mIGNvbnRlbnQgaXMgd2VsbCBrbm93biBhbmQgc2FmZSB0byBoYW5kbGVcbiAgICAgIHJldHVybiBKU09OLnBhcnNlKGV2ZW50LmRhdGFUcmFuc2Zlcj8uZ2V0RGF0YShtaW1lVHlwZSkgPz8gJ3t9Jyk7XG4gICAgfVxuXG4gICAgLy8gdGhlIGNvbnRhaW5lZCBkYXRhIGlzIHVua25vd24sIGxldCB1c2VyIGhhbmRsZSBpdFxuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIGlmIChtaW1lVHlwZSAhPT0gbnVsbCkge1xuICAgIC8vIHRoZSB0eXBlIG9mIGNvbnRlbnQgaXMgd2VsbCBrbm93biBhbmQgc2FmZSB0byBoYW5kbGVcbiAgICByZXR1cm4gSlNPTi5wYXJzZShldmVudC5kYXRhVHJhbnNmZXI/LmdldERhdGEobWltZVR5cGUpID8/ICd7fScpO1xuICB9XG5cbiAgLy8gdGhlIGNvbnRhaW5lZCBkYXRhIGlzIHVua25vd24sIGxldCB1c2VyIGhhbmRsZSBpdFxuICByZXR1cm4ge307XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXJFZmZlY3RzKFxuICBlZmZlY3RzOiBEcm9wRWZmZWN0W10sXG4gIGFsbG93ZWQ6IEVmZmVjdEFsbG93ZWQgfCBEcm9wRWZmZWN0XG4pOiBEcm9wRWZmZWN0W10ge1xuICBpZiAoYWxsb3dlZCA9PT0gJ2FsbCcgfHwgYWxsb3dlZCA9PT0gJ3VuaW5pdGlhbGl6ZWQnKSB7XG4gICAgcmV0dXJuIGVmZmVjdHM7XG4gIH1cblxuICByZXR1cm4gZWZmZWN0cy5maWx0ZXIoZnVuY3Rpb24gKGVmZmVjdCkge1xuICAgIHJldHVybiBhbGxvd2VkLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihlZmZlY3QpICE9PSAtMTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREaXJlY3RDaGlsZEVsZW1lbnQoXG4gIHBhcmVudEVsZW1lbnQ6IEVsZW1lbnQsXG4gIGNoaWxkRWxlbWVudDogRWxlbWVudFxuKTogRWxlbWVudCB8IG51bGwge1xuICBsZXQgZGlyZWN0Q2hpbGQ6IE5vZGUgPSBjaGlsZEVsZW1lbnQ7XG5cbiAgd2hpbGUgKGRpcmVjdENoaWxkLnBhcmVudE5vZGUgIT09IHBhcmVudEVsZW1lbnQpIHtcbiAgICAvLyByZWFjaGVkIHJvb3Qgbm9kZSB3aXRob3V0IGZpbmRpbmcgZ2l2ZW4gcGFyZW50XG4gICAgaWYgKCFkaXJlY3RDaGlsZC5wYXJlbnROb2RlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBkaXJlY3RDaGlsZCA9IGRpcmVjdENoaWxkLnBhcmVudE5vZGU7XG4gIH1cblxuICByZXR1cm4gZGlyZWN0Q2hpbGQgYXMgRWxlbWVudDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNob3VsZFBvc2l0aW9uUGxhY2Vob2xkZXJCZWZvcmVFbGVtZW50KFxuICBldmVudDogRHJhZ0V2ZW50LFxuICBlbGVtZW50OiBFbGVtZW50LFxuICBob3Jpem9udGFsOiBib29sZWFuXG4pIHtcbiAgY29uc3QgYm91bmRzID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAvLyBJZiB0aGUgcG9pbnRlciBpcyBpbiB0aGUgdXBwZXIgaGFsZiBvZiB0aGUgbGlzdCBpdGVtIGVsZW1lbnQsXG4gIC8vIHdlIHBvc2l0aW9uIHRoZSBwbGFjZWhvbGRlciBiZWZvcmUgdGhlIGxpc3QgaXRlbSwgb3RoZXJ3aXNlIGFmdGVyIGl0LlxuICBpZiAoaG9yaXpvbnRhbCkge1xuICAgIHJldHVybiBldmVudC5jbGllbnRYIDwgYm91bmRzLmxlZnQgKyBib3VuZHMud2lkdGggLyAyO1xuICB9XG5cbiAgcmV0dXJuIGV2ZW50LmNsaWVudFkgPCBib3VuZHMudG9wICsgYm91bmRzLmhlaWdodCAvIDI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVEcmFnSW1hZ2VPZmZzZXQoXG4gIGV2ZW50OiBEcmFnRXZlbnQsXG4gIGRyYWdJbWFnZTogRWxlbWVudFxuKTogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9IHtcbiAgY29uc3QgZHJhZ0ltYWdlQ29tcHV0ZWRTdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGRyYWdJbWFnZSk7XG4gIGNvbnN0IHBhZGRpbmdUb3AgPSBwYXJzZUZsb2F0KGRyYWdJbWFnZUNvbXB1dGVkU3R5bGUucGFkZGluZ1RvcCkgfHwgMDtcbiAgY29uc3QgcGFkZGluZ0xlZnQgPSBwYXJzZUZsb2F0KGRyYWdJbWFnZUNvbXB1dGVkU3R5bGUucGFkZGluZ0xlZnQpIHx8IDA7XG4gIGNvbnN0IGJvcmRlclRvcCA9IHBhcnNlRmxvYXQoZHJhZ0ltYWdlQ29tcHV0ZWRTdHlsZS5ib3JkZXJUb3BXaWR0aCkgfHwgMDtcbiAgY29uc3QgYm9yZGVyTGVmdCA9IHBhcnNlRmxvYXQoZHJhZ0ltYWdlQ29tcHV0ZWRTdHlsZS5ib3JkZXJMZWZ0V2lkdGgpIHx8IDA7XG5cbiAgcmV0dXJuIHtcbiAgICB4OiBldmVudC5vZmZzZXRYICsgcGFkZGluZ0xlZnQgKyBib3JkZXJMZWZ0LFxuICAgIHk6IGV2ZW50Lm9mZnNldFkgKyBwYWRkaW5nVG9wICsgYm9yZGVyVG9wLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0RHJhZ0ltYWdlKFxuICBldmVudDogRHJhZ0V2ZW50LFxuICBkcmFnSW1hZ2U6IEVsZW1lbnQsXG4gIG9mZnNldEZ1bmN0aW9uOiBEbmREcmFnSW1hZ2VPZmZzZXRGdW5jdGlvblxuKTogdm9pZCB7XG4gIGNvbnN0IG9mZnNldCA9IG9mZnNldEZ1bmN0aW9uKGV2ZW50LCBkcmFnSW1hZ2UpIHx8IHsgeDogMCwgeTogMCB9O1xuXG4gIChldmVudC5kYXRhVHJhbnNmZXIgYXMgYW55KS5zZXREcmFnSW1hZ2UoZHJhZ0ltYWdlLCBvZmZzZXQueCwgb2Zmc2V0LnkpO1xufVxuIl19